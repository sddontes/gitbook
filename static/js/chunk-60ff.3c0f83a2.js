(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-60ff"],{"1Z/X":function(e,t,r){"use strict";var o=r("azbV");r.n(o).a},"8Acb":function(e,t,r){"use strict";var o=r("4d7F"),i=r.n(o),n=r("vDqi"),s=r.n(n),l=r("XJYT"),a=r("Q2AE"),u=r("kkBN"),d=r("Qyje"),c=r.n(d),m=s.a.create({timeout:5e3});m.interceptors.request.use(function(e){return"get"===e.method&&(e.paramsSerializer=function(e){return c.a.stringify(e,{arrayFormat:"repeat"})}),a.a.getters.token&&(e.headers.Authorization="bearer"+Object(u.a)()),e},function(e){i.a.reject(e)}),m.interceptors.response.use(function(e){var t=e;return 200!==t.status?(Object(l.Message)({message:t.message,type:"error",duration:5e3}),i.a.reject("error")):403===t.data.code?(Object(l.Message)({message:t.data.message,type:"error",duration:5e3}),i.a.reject("error")):401===t.data.code?(l.MessageBox.confirm("你的登录信息已过期，请重新登录","确定登出",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then(function(){a.a.dispatch("FedLogOut").then(function(){location.reload()})}),i.a.reject("error")):e.data},function(e){switch(e.response.status){case 403:l.MessageBox.confirm("你的登录信息已过期，请重新登录","确定登出",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then(function(){a.a.dispatch("FedLogOut").then(function(){location.reload()})});break;case 500:Object(l.Message)({message:e.response.data.message,type:"error",duration:5e3})}});var h=m,p="http://bzy.hhotel.com",f=p+"/bzy-upms/";t.a={login:function(e){return h({method:"post",url:p+"login",data:e})},logout:function(e){return h({method:"get",url:p+"rios-auth/logouting",params:e})},getLoginUserInfo:function(){return h({method:"post",url:p+"rios-auth/user"})},addMenu:function(e){return h({method:"POST",url:f+"menu",data:e})},getMenuList:function(e){return h({method:"get",url:f+"menu/tree",params:e})},updateMenuList:function(e){return h({method:"PUT",url:f+"menu",data:e})},deleteMenuList:function(e){return h({method:"DELETE",url:f+"menu/"+e})},getAuthUserMenu:function(){return h({method:"GET",url:f+"authUser/findMenu"})},getMenuDetail:function(e){return h({method:"get",url:f+"menu/"+e})},getRoleList:function(){return h({method:"get",url:f+"role/list"})},addRole:function(e){return h({method:"POST",url:f+"role",data:e})},updateRole:function(e){return h({method:"PUT",url:f+"role",data:e})},getRoleDetail:function(e){return h({method:"get",url:f+"role/"+e})},verifyRoleCode:function(e){return h({method:"get",url:f+"role/validateCode/"+e})},verifyRoleName:function(e){return h({method:"get",url:f+"role/validateName/"+e})},deleteRole:function(e){return h({method:"DELETE",url:f+"role/"+e})},getUserList:function(e){return h({method:"get",url:f+"authUser/list",params:e})},addUser:function(e){return h({method:"POST",url:f+"authUser",data:e})},getUser:function(e){return h({method:"GET",url:f+"authUser/"+e})},updateUser:function(e){return h({method:"PUT",url:f+"authUser",data:e})},deleteUser:function(e){return h({method:"DELETE",url:f+"authUser/"+e})},disabledUser:function(e){return h({method:"PUT",url:f+"authUser/forbidden/"+e})},validateUser:function(e){return h({method:"GET",url:f+"authUser/validate",params:e})},getUserInfo:function(){return h({method:"GET",url:f+"authUser/info"})},modifyUserInfo:function(e){return h({method:"PUT",url:f+"authUser/update",data:e})},findRolesByUserId:function(){return h({method:"GET",url:f+"authUser/findRolesByUserId"})},modifyUserPassword:function(e){return h({method:"PUT",url:f+"authUser/updatePassword",data:e})},validatePassword:function(e,t){return h({method:"GET",url:f+"authUser/validatePassword",params:t})},getDepartmentList:function(){return h({method:"get",url:f+"department/list"})}}},ZLdr:function(e,t,r){"use strict";r.r(t);var o=r("QbLZ"),i=r.n(o),n=r("8Acb"),s=r("8gzE"),l=r("L2JU"),a={name:"Rolemenage",data:function(){var e=this;return{buttonFilter:"",showBillButton:[],billMenuList:[],userRoleList:[],roleTypeList:[],editRoleTypeList:[],isAdd:!1,parentMenus:[],formTitle:"",dialogFormRole:!1,roleList:[],oldName:"",oldCode:"",menuList:[],ruleForm:{name:"",alias:"",type:"",typeName:"",remarks:"",menus:[],id:""},rules:{name:[{validator:function(t,r,o){if(!r)return o(new Error("角色名称不能为空!"));1===e.roleFlag&&e.oldName!==e.ruleForm.name||0===e.roleFlag?n.a.verifyRoleName(r).then(function(e){e.data.canUsed?o():o(new Error("角色名称已存在"))}).catch():o()},trigger:"blur",required:!0}],alias:[{validator:function(e,t,r){return t?/^[A-Za-z\d]+$/g.test(t)?void r():r(new Error("角色别名为数字或英文")):r(new Error("角色别名不能为空！"))},trigger:"blur",required:!0}],type:[{trigger:"change",required:!0,message:"请选择角色类型"}]},defaultProps:{children:"children",label:"name"}}},methods:{clickAddRole:function(){this.formTitle="新增角色",this.roleFlag=0,this.dialogFormRole=!0,this.isAdd=!0},getUserRoleList:function(){var e=this;n.a.findRolesByUserId().then(function(t){e.userRoleList=t.data;var r={code:"ROLE_D_M",desc:"部门MASTER"},o={code:"ROLE_USER",desc:"用户"};-1!==e.userRoleList.indexOf("ROLE_S_ADMIN")?(e.roleTypeList.push({code:"ROLE_ADMIN",desc:"管理员"}),e.roleTypeList.push(r),e.roleTypeList.push(o)):-1!==e.userRoleList.indexOf("ROLE_ADMIN")?(e.roleTypeList.push(r),e.roleTypeList.push(o)):-1!==e.userRoleList.indexOf("ROLE_D_M")&&e.roleTypeList.push(o)}).catch()},clickEditRole:function(e){var t=this;this.isAdd=!1,this.formTitle="编辑角色",this.roleFlag=1,this.dialogFormRole=!0,n.a.getRoleDetail(e.id).then(function(e){t.ruleForm.code=e.data.code,t.ruleForm.type=e.data.type;var r={code:"ROLE_ADMIN",desc:"管理员"},o={code:"ROLE_D_M",desc:"部门MASTER"},i={code:"ROLE_USER",desc:"用户"};t.editRoleTypeList=[],"ROLE_S_ADMIN"===t.ruleForm.type?t.editRoleTypeList.push({code:"ROLE_S_ADMIN",desc:"超级管理员"}):"ROLE_ADMIN"===t.ruleForm.type?-1!==t.userRoleList.indexOf("ROLE_S_ADMIN")?(t.editRoleTypeList.push(r),t.editRoleTypeList.push(o),t.editRoleTypeList.push(i)):-1!==t.userRoleList.indexOf("ROLE_ADMIN")?(t.editRoleTypeList.push(o),t.editRoleTypeList.push(i)):t.editRoleTypeList.push(r):"ROLE_D_M"===t.ruleForm.type?-1!==t.userRoleList.indexOf("ROLE_S_ADMIN")?(t.editRoleTypeList.push(o),t.editRoleTypeList.push(i)):-1!==t.userRoleList.indexOf("ROLE_ADMIN")?(t.editRoleTypeList.push(o),t.editRoleTypeList.push(i)):t.editRoleTypeList.push(o):"ROLE_USER"===t.ruleForm.type&&(-1!==t.userRoleList.indexOf("ROLE_S_ADMIN")?(t.editRoleTypeList.push(r),t.editRoleTypeList.push(o),t.editRoleTypeList.push(i)):-1!==t.userRoleList.indexOf("ROLE_ADMIN")?(t.editRoleTypeList.push(o),t.editRoleTypeList.push(i)):t.editRoleTypeList.push(i)),t.ruleForm.typeName=e.data.typeName,t.ruleForm.menus=e.data.menus,t.ruleForm.remarks=e.data.remarks,t.ruleForm.alias=e.data.alias,t.ruleForm.name=e.data.name,t.ruleForm.id=e.data.id,t.oldName=e.data.name,t.parentId=t.reduceParent(t.menuList)}).catch()},cancel:function(e,t){this.roleList[e]._pop=!1},okDelete:function(e,t){var r=this;this.roleList[e]._pop=!1,n.a.deleteRole(t.id).then(function(e){window.location.reload(),r.getRoleList()}).catch()},getRoleList:function(){var e=this;n.a.getRoleList().then(function(t){e.roleList=t.data}).catch()},getMenuList:function(){var e=this;n.a.getMenuList().then(function(t){e.menuList=t.data}).catch()},getCheckedKeys:function(){this.ruleForm.menus=this.$refs.tree.getCheckedKeys();var e=this.$refs.tree.getHalfCheckedKeys().concat(this.ruleForm.menus);this.ruleForm.menus=this.uniqueArr(e)},validateName:function(){var e=this;return n.a.verifyRoleName(this.ruleForm.name).then(function(t){e.verifyName=t.data.canUsed}).catch(),this.verifyName},resetForm:function(){this.$refs.ruleForm.resetFields(),this.dialogFormRole=!1,this.$refs.tree.setCheckedKeys([]),this.ruleForm.menus=[],this.ruleForm.name="",this.ruleForm.remarks="",this.ruleForm.type="",this.ruleForm.typeName="",this.ruleForm.alias=""},addRole:function(){var e=this,t={type:this.ruleForm.type,menus:this.ruleForm.menus,name:this.ruleForm.name,remarks:this.ruleForm.remarks,alias:this.ruleForm.alias};n.a.addRole(t).then(function(t){e.resetForm(),e.getRoleList(),e.getMenuList(),e.setBillMenu(),setTimeout(function(){window.location.reload()},1e3)}).catch()},editRole:function(){var e=this,t={type:this.ruleForm.type,menus:this.ruleForm.menus,name:this.ruleForm.name,remarks:this.ruleForm.remarks,alias:this.ruleForm.alias,id:this.ruleForm.id};this.resetForm(),n.a.updateRole(t).then(function(t){e.getRoleList(),e.getMenuList(),e.setBillMenu(),setTimeout(function(){window.location.reload()},0)}).catch()},submitForm:function(e){var t=this;this.getCheckedKeys(),this.$refs[e].validate(function(e){if(!e)return t.$message.error("信息填写错误"),!1;0===t.roleFlag?t.addRole():1===t.roleFlag&&t.editRole()})},uniqueArr:function(e){for(var t=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&t.push(e[r]);return t},reduceParent:function(e){var t=this,r=this.ruleForm.menus;return e.length>0&&e.map(function(e,o){if(e.children.length>0){for(var i in r)r[i]===e.id&&t.parentMenus.push(e.id);e.children.length>0&&t.reduceParent(e.children)}}),this.parentMenus.map(function(e,r){for(var o in t.ruleForm.menus)e===t.ruleForm.menus[o]&&t.ruleForm.menus.splice(o,1)}),this.parentMenus},setBillMenu:function(){if(this.billMenu.length){var e=this;s.a.refreshBillMenuList(this.billMenu,"system-settings/roleManage/list",function(t){e.showBillButton=t})}}},computed:i()({},Object(l.b)(["billMenu"])),watch:{billMenu:function(){this.setBillMenu()}},created:function(){this.getUserRoleList(),this.getRoleList(),this.getMenuList(),this.setBillMenu(),this.buttonFilter=s.a.buttonFilter}},u=(r("1Z/X"),r("KHd+")),d=Object(u.a)(a,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("div",{staticClass:"btn-wrap",staticStyle:{margin:"0px 0px 10px 0px"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.clickAddRole}},[e._v("新增角色")])],1),e._v(" "),r("div",{staticClass:"table-wrap"},[r("el-table",{staticStyle:{width:"100%","border-radius":"8px"},attrs:{data:e.roleList}},[r("el-table-column",{attrs:{prop:"name",label:"角色"}}),e._v(" "),r("el-table-column",{attrs:{prop:"typeName",label:"角色类型"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit icon",circle:""},on:{click:function(r){e.clickEditRole(t.row)}}}),e._v(" "),r("el-popover",{staticStyle:{margin:"0 10px"},attrs:{placement:"top",width:"160"},model:{value:e.roleList[t.$index]._pop,callback:function(r){e.$set(e.roleList[t.$index],"_pop",r)},expression:"roleList[scope.$index]._pop"}},[r("p",[e._v("确定要删除这个角色吗？")]),e._v(" "),r("div",{staticStyle:{"text-align":"right",margin:"0"}},[r("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(r){e.cancel(t.$index,t.row)}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(r){e.okDelete(t.$index,t.row)}}},[e._v("确定")])],1),e._v(" "),r("el-button",{attrs:{slot:"reference",type:"danger",size:"mini",icon:"el-icon-delete icon",circle:""},slot:"reference"})],1)]}}])})],1)],1),e._v(" "),r("el-dialog",{attrs:{title:e.formTitle,visible:e.dialogFormRole},on:{"update:visible":function(t){e.dialogFormRole=t},close:e.resetForm}},[r("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.ruleForm,"default-expand-all":"true","label-width":"100px"}},[r("el-form-item",{attrs:{prop:"name",label:"角色名称"}},[r("el-input",{model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name","string"==typeof t?t.trim():t)},expression:"ruleForm.name"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.roleTypeList.length,expression:"roleTypeList.length"}],attrs:{prop:"type",label:"角色类型"}},[e.isAdd?r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.roleTypeList,function(e){return r("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})})):e._e(),e._v(" "),e.isAdd?e._e():r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},e._l(e.editRoleTypeList,function(e){return r("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})}))],1),e._v(" "),r("el-form-item",{attrs:{prop:"alias",label:"角色别名"}},[r("el-input",{attrs:{disabled:!e.isAdd},model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias","string"==typeof t?t.trim():t)},expression:"ruleForm.alias"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.remarks,callback:function(t){e.$set(e.ruleForm,"remarks",t)},expression:"ruleForm.remarks"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"权限"}},[r("el-tree",{ref:"tree",attrs:{data:e.menuList,"default-checked-keys":e.ruleForm.menus,props:e.defaultProps,"default-expand-all":!1,"highlight-current":"","show-checkbox":"","node-key":"id"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")]),e._v(" "),r("el-button",{on:{click:function(t){e.resetForm("ruleForm")}}},[e._v("取消")])],1)],1)],1)],1)},[],!1,null,"82ef5638",null);d.options.__file="roleManage.vue";t.default=d.exports},azbV:function(e,t,r){}}]);