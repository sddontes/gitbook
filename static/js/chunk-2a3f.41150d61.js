(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2a3f"],{"6aKk":function(t,e,a){"use strict";a.d(e,"p",function(){return l}),a.d(e,"r",function(){return s}),a.d(e,"q",function(){return o}),a.d(e,"o",function(){return i}),a.d(e,"n",function(){return r}),a.d(e,"v",function(){return c}),a.d(e,"a",function(){return u}),a.d(e,"k",function(){return d}),a.d(e,"h",function(){return f}),a.d(e,"l",function(){return m}),a.d(e,"m",function(){return p}),a.d(e,"b",function(){return _}),a.d(e,"d",function(){return v}),a.d(e,"c",function(){return h}),a.d(e,"e",function(){return b}),a.d(e,"j",function(){return y}),a.d(e,"g",function(){return g}),a.d(e,"f",function(){return I}),a.d(e,"s",function(){return C}),a.d(e,"i",function(){return j}),a.d(e,"t",function(){return w}),a.d(e,"u",function(){return D});var n=a("CcjM");function l(t){return Object(n.a)({url:"bzy-csg-settlement/settlementModel/pageList",method:"post",data:t})}function s(t){return Object(n.a)({url:"bzy-csg-settlement/settlementSubject/rule/pageList",method:"post",data:t})}function o(t){return Object(n.a)({url:"bzy-csg-settlement/settlementSubject/rule/detail/"+t,method:"get"})}function i(t){return Object(n.a)({url:"bzy-csg-settlement/bill/list",method:"post",data:t})}function r(t){return Object(n.a)({url:"bzy-csg-settlement/bill/queryBillDetail/"+t,method:"get"})}function c(t){return Object(n.a)({url:"bzy-csg-settlement/dataSync/serviceFeeExcel",method:"post",data:t})}function u(t){return Object(n.a)({url:"bzy-csg-settlement/settlementSubject/mini/achievement",method:"post",data:t})}function d(t){return Object(n.a)({url:"bzy-csg-settlement/billInfoAdjust/listByMultiselect",method:"post",data:t})}function f(t){return Object(n.a)({url:"bzy-csg-settlement/email/sendLog",method:"post",data:t})}function m(t){return Object(n.a)({url:"bzy-csg-settlement/paybill/pageList",method:"post",data:t})}function p(t){return Object(n.a)({url:"bzy-csg-settlement/email",method:"post",data:t})}function _(t){return Object(n.a)({url:"bzy-csg-settlement/billInfoAdjust/addBillInfoAdjust",method:"post",data:t})}function v(t){return Object(n.a)({url:"bzy-csg-settlement/billExtendConf?"+t,method:"get"})}function h(t){return Object(n.a)({url:"bzy-csg-settlement/billExtendConf",method:"post",data:t})}function b(t,e){return Object(n.a)({url:"bzy-csg-settlement/billExtendConf/"+t,data:e,method:"put",headers:{"Content-Type":"text/plain;charset=UTF-8"}})}function y(t){return Object(n.a)({url:"bzy-csg-settlement/dataSync/billExtend",method:"post",data:t})}function g(t){return Object(n.a)({url:"bzy-csg-settlement/billExtend/hierarchy",params:t,method:"get"})}function I(t){return Object(n.a)({url:"bzy-csg-settlement/billExtend/hotel",params:t,method:"get"})}function C(t){return Object(n.a)({url:"bzy-csg-settlement/settlementModel/list",data:t,method:"post"})}function j(t){return Object(n.a)({url:"bzy-csg-settlement/billInfoAdjust/importBillAdjustExcel",data:t,method:"post"})}function w(t){return Object(n.a)({url:"bzy-csg-settlement/transaction/payment",data:t,headers:{"Content-Type":"text/plain;charset=UTF-8"},method:"post"})}function D(t){return Object(n.a)({url:"bzy-csg-settlement/transaction/receipt",data:t,headers:{"Content-Type":"text/plain;charset=UTF-8"},method:"post"})}},ASsg:function(t,e,a){"use strict";a.r(e);var n=a("6aKk"),l={name:"SettleAccountsCostDetail",mixins:[a("t2Y8").a],data:function(){return{PATH:"settle-accounts/settle-accounts-costdetail",restartFlag:!1,projectInfo:{billNo:0},subTotalBillInfoDetails:{},billCycle:"",oparateDay:"",collFeeTotalBillInfoDetails:{},projectManagerData:{},gmvManageFee:{amount:0,oriAmount:0},gmvServiceFee:{amount:0,oriAmount:0},otaFee:{amount:0,oriAmount:0},hotelManagerFee:{amount:0,oriAmount:0},payManagerFee:{amount:0,oriAmount:0},changeManagerFee:{amount:0,oriAmount:0},dateData:[2019],dateChoose:2019,tableData:[1e3,1100,1200,1300],dialogVisible:!1,formData:[{account:0,value:[],remark:""}],addBillData:{},dataTypeList:[],billItemList:[],errTips:[],loading:!1}},watch:{billItemList:{handler:function(t,e){},deep:!0}},mounted:function(){this._settleAccountsCostDetail(this.$route.query.billNo),this._billSubitemExtend()},methods:{_settleAccountsCostDetail:function(t){var e=this;Object(n.n)(t).then(function(t){if(t.data){e.projectInfo=t.data,e.projectInfo.subTotalBillInfoDetails.forEach(function(t){e.subTotalBillInfoDetails[t.billInfoCode]=t});var a=[];a.push(e.subTotalBillInfoDetails.GMV_SERVICE_FEE),a.push(e.subTotalBillInfoDetails.BRAND_FRANCHISE_FEE),a.push(e.subTotalBillInfoDetails.MEMBER_CARD_SALES_FEE),a.push(e.subTotalBillInfoDetails.OTHER_RETURN),e.projectInfo.subTotalBillInfoDetails=a.filter(function(t){return void 0!==t}),e.projectInfo.collFeeTotalBillInfoDetails.forEach(function(t){e.collFeeTotalBillInfoDetails[t.billInfoCode]=t});var n=[];n.push(e.collFeeTotalBillInfoDetails.ONLINE_ROOM_FEE),n.push(e.collFeeTotalBillInfoDetails.MEMBER_POINT_FEE),n.push(e.collFeeTotalBillInfoDetails.HOTEL_MANAGER_FEE),n.push(e.collFeeTotalBillInfoDetails.OTHER_COLLECTION_AND_PAYMENT_SETTLEMENT),e.projectInfo.collFeeTotalBillInfoDetails=n.filter(function(t){return void 0!==t}),e.oparateDay=t.data.days,e.billCycle=t.data.payExplain.split(" - ")}else e.$message("未获取到结算单详情")})},_getDateStatus:function(t){return t?t.slice(0,10):"无"},_adjust:function(){this.dialogVisible=!0},_addBillItem:function(){this.formData.push({account:0,value:[],remark:""})},submitUpload:function(){var t=this;if(this.errTips=[],this.formData.forEach(function(e,a){var n=t.checkRule(e);n&&(t.errTips[a]=n)}),this.billCycle[1])if(this.errTips.length)this.$message.error("请填写需要调整的项目");else{if(!this.oparateDay||this.oparateDay>31||this.oparateDay<1)return this.$message.error("请填写正确的运营天数"),void(this.oparateDay=this.projectInfo.days);var e=[];this.formData.forEach(function(a,n){e.push({billInfoName:a.value[0],billInfoExtend:a.value[1],count:t.projectInfo.days,amount:a.account,remark:a.remark})});var a={count:this.oparateDay,payExplain:this.billCycle[0]+" - "+this.billCycle[1],billNo:this.projectInfo.billNo,billAdjustForms:e};this.loading=!0,Object(n.b)(a).then(function(e){"success"===e.message?(t.$message({type:"success",message:"调整单提交成功"}),t._settleAccountsCostDetail(t.$route.query.billNo)):t.$message.error(e.message),t.loading=!1,t.formData=[{account:0,value:[],remark:""}],t.dialogVisible=!1})}else this.$message.error("请填写计费周期")},checkRule:function(t){var e="";return t.remark||(e="说明不能为空"),t.account||(e="调整金额不能为空或者0"),t.value.length||(e="调整项不能为空"),t.account.toString().split(".")[1]&&t.account.toString().split(".")[1].length>2&&(e="调整后金额最多保留2位小数点"),e},handleChange:function(t){var e=this;this.formData.forEach(function(a,n){a.value[1]===e.formData[t].value[1]&&n!==t&&(e.$message.error("调整项不可重复"),e.formData[t].value=null)})},deleteItem:function(t){var e=this,a=[];this.formData.forEach(function(n,l){t!==l&&a.push(e.formData[l])}),this.formData=a},_billSubitemExtend:function(){var t=this;Object(n.g)().then(function(e){t.dataTypeList=e;for(var a=0;a<t.dataTypeList.length;a++)0===t.dataTypeList[a].children.length?delete t.dataTypeList[a].children:t.dataTypeList[a].children.length&&t.dataTypeList[a].children[0].value===t.dataTypeList[a].value&&delete t.dataTypeList[a].children})}}},s=(a("PvAq"),a("KHd+")),o=Object(s.a)(l,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-content"},[a("el-card",[a("div",{staticClass:"clearfix"},[a("i",{staticClass:"span-left-green"}),t._v(" "),a("span",{staticClass:"span-left-item",staticStyle:{color:"#333333","font-size":"16px"}},[t._v("业务结算明细 ("+t._s(t.projectInfo.billNo)+")")]),t._v(" "),t.buttonFilter("settle-accounts",t.btnArr)?a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:t._adjust}},[t._v("调整")]):t._e()],1)]),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:24}})],1),t._v(" "),a("el-card",[a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("名称：")]),t._v("\n        "+t._s(t.projectInfo.hotelCode)+t._s(t.projectInfo.hotelName)+"\n      ")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("所属账期：")]),t._v("\n        "+t._s(t.projectInfo.batchNo)+"\n      ")])],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("签约主体：")]),t._v("\n        "+t._s(t.projectInfo.signCompany)+"\n      ")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("运营状态：")]),t._v("\n        "+t._s(t.projectInfo.opStatus)+"\n      ")])],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("合作模式：")]),t._v("\n        "+t._s(t.projectInfo.cooperationMode?t.projectInfo.cooperationMode:"0")+"\n      ")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("业绩起算日：")]),t._v("\n        "+t._s(t._getDateStatus(t.projectInfo.confirmationLetterDate))+"\n      ")])],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("业务模块：")]),t._v("\n        "+t._s(t.projectInfo.module?t.projectInfo.module:"无")+"\n      ")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("计费周期：")]),t._v("\n        "+t._s(t.projectInfo.payExplain)+"\n      ")])],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("运营天数：")]),t._v("\n        "+t._s(t.projectInfo.days)+"天\n      ")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("结算模式：")]),t._v("\n        "+t._s(t.projectInfo.settlementModel)+"\n      ")])],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("管理服务费率：")]),t._v("\n        "+t._s((100*t.projectInfo.chargeRate).toFixed(2))+" %\n      ")]),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",{staticClass:"settle-item-name"},[t._v("业绩保底金额：")]),t._v("\n        "+t._s(t.projectInfo.miniEnsureMoney?"￥"+t.projectInfo.miniEnsureMoney:"无")+"\n      ")])],1)],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:24}})],1),t._v(" "),a("el-card",[a("div",{staticClass:"clearfix"},[a("i",{staticClass:"span-left-green"}),t._v(" "),a("span",{staticClass:"span-left-item",staticStyle:{color:"#333333","font-size":"16px"}},[t._v("本月合计：收费小计（￥"+t._s(t.projectInfo.subTotal?t.projectInfo.subTotal:0)+"）+代收代付小计（￥"+t._s(t.projectInfo.collFeeWithPayFee?t.projectInfo.collFeeWithPayFee:0)+"）")])])]),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:24}})],1),t._v(" "),a("el-card",[a("el-row",{staticClass:"card-content-row",staticStyle:{color:"#333333","font-size":"16px"}},[a("i",{staticClass:"itemIcon"}),t._v("\n      收费小计（￥"+t._s(t.projectInfo.subTotal?t.projectInfo.subTotal:0)+"）\n    ")]),t._v(" "),a("table",[a("tr",[a("th",{staticStyle:{width:"24%"}},[t._v("项目")]),t._v(" "),a("th",{staticStyle:{width:"24%"}},[t._v("金额")]),t._v(" "),a("th",{staticStyle:{width:"24%"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{width:"24%"}},[t._v("说明")])]),t._v(" "),t._l(t.projectInfo.subTotalBillInfoDetails,function(e){return[0===e.billInfoExtendDetailVos.length?[a("tr",{key:e.billInfoName},[a("td",{staticStyle:{width:"24%"}},[t._v(t._s(e.billInfoName))]),t._v(" "),a("td",{staticStyle:{width:"24%"}},[t._v("\n              ￥ "+t._s(e.amount)+"\n              "),a("br"),t._v("\n              ￥ "+t._s(e.oriAmount)+"(初始值)\n            ")]),t._v(" "),a("td",{staticStyle:{width:"24%"}}),t._v(" "),a("td",{staticStyle:{width:"24%"}})])]:t._l(e.billInfoExtendDetailVos,function(n,l){return a("tr",{key:l},[0===l?a("td",{staticStyle:{width:"24%"},attrs:{rowspan:e.billInfoExtendDetailVos.length}},[t._v(t._s(e.billInfoName))]):t._e(),t._v(" "),0===l?a("td",{staticStyle:{width:"24%"},attrs:{rowspan:e.billInfoExtendDetailVos.length}},[t._v("\n              ￥ "+t._s(e.amount)+"\n              "),a("br"),t._v("\n              ￥ "+t._s(e.oriAmount)+"(初始值)\n            ")]):t._e(),t._v(" "),a("td",{staticStyle:{width:"24%"}},[t._v("\n              "+t._s(n.billInfoExtendName)+" : ￥ "+t._s(n.amount)+"\n              "),a("br"),t._v("\n              初始值: ￥ "+t._s(n.oriAmount)+"\n            ")]),t._v(" "),a("td",{staticStyle:{width:"24%"}},[t._v(t._s(n.remark))])])})]})],2)],1),t._v(" "),a("el-row",{staticClass:"card-content-row"},[a("el-col",{attrs:{span:24}})],1),t._v(" "),a("el-card",[a("el-row",{staticClass:"card-content-row",staticStyle:{color:"#333333","font-size":"16px"}},[a("i",{staticClass:"itemIcon"}),t._v("\n      代收代付小计（￥"+t._s(t.projectInfo.collFeeWithPayFee?t.projectInfo.collFeeWithPayFee:0)+"）\n    ")]),t._v(" "),a("table",[a("tr",[a("th",{staticStyle:{width:"24%"}},[t._v("项目")]),t._v(" "),a("th",{staticStyle:{width:"24%"}},[t._v("金额")]),t._v(" "),a("th",{staticStyle:{width:"24%"}},[t._v("内容")]),t._v(" "),a("th",{staticStyle:{width:"24%"}},[t._v("说明")])]),t._v(" "),t._l(t.projectInfo.collFeeTotalBillInfoDetails,function(e){return[0===e.billInfoExtendDetailVos.length?[a("tr",{key:e.billInfoName},[a("td",{staticStyle:{width:"24%"}},[t._v(t._s(e.billInfoName))]),t._v(" "),a("td",{staticStyle:{width:"24%"}},[t._v("\n              ￥ "+t._s(e.amount)+"\n              "),a("br"),t._v("\n              ￥ "+t._s(e.oriAmount)+"(初始值)\n            ")]),t._v(" "),a("td",{staticStyle:{width:"24%"}}),t._v(" "),a("td",{staticStyle:{width:"24%"}})])]:t._l(e.billInfoExtendDetailVos,function(n,l){return a("tr",{key:l},[0===l?a("td",{staticStyle:{width:"24%"},attrs:{rowspan:e.billInfoExtendDetailVos.length}},[t._v(t._s(e.billInfoName))]):t._e(),t._v(" "),0===l?a("td",{staticStyle:{width:"24%"},attrs:{rowspan:e.billInfoExtendDetailVos.length}},[t._v("\n              ￥ "+t._s(e.amount)+"\n              "),a("br"),t._v("\n              ￥ "+t._s(e.oriAmount)+"(初始值)\n            ")]):t._e(),t._v(" "),a("td",{staticStyle:{width:"24%"}},[t._v("\n              "+t._s(n.billInfoExtendName)+" : ￥ "+t._s(n.amount)+"\n              "),a("br"),t._v("\n              初始值: ￥ "+t._s(n.oriAmount)+"\n            ")]),t._v(" "),a("td",{staticStyle:{width:"24%"}},[t._v(t._s(n.remark))])])})]})],2)],1),t._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{visible:t.dialogVisible,title:"调整单录入",width:"900px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"lineClass",staticStyle:{"margin-top":"-20px"}}),t._v(" "),a("el-form",{staticClass:"demo-form-inline settleForm",attrs:{inline:!0,"label-width":"100px","label-position":"left"}},[a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"结算方"}},[t._v(t._s(t.projectInfo.hotelName))]),t._v(" "),a("el-form-item",{staticStyle:{width:"250px"},attrs:{label:"结算账期"}},[t._v(t._s(t.projectInfo.batchNo))]),t._v(" "),a("el-form-item",{staticStyle:{width:"250px"},attrs:{label:"所属账期"}},[t._v(t._s(t.projectInfo.batchNo))]),t._v(" "),a("el-form-item",{staticStyle:{width:"300px"},attrs:{label:"运营天数",required:""}},[a("el-input",{staticStyle:{width:"150px"},attrs:{type:"number"},model:{value:t.oparateDay,callback:function(e){t.oparateDay=e},expression:"oparateDay"}}),t._v("  天\n      ")],1),t._v(" "),a("el-form-item",{staticStyle:{width:"450px"},attrs:{label:"计费周期",required:""}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"—","value-format":"yyyy-MM-dd","start-placeholder":"开始月份","end-placeholder":"结束月份"},model:{value:t.billCycle,callback:function(e){t.billCycle=e},expression:"billCycle"}})],1),t._v(" "),a("div",{staticStyle:{clear:"both"}}),t._v(" "),a("span",{staticStyle:{float:"right",color:"#006072",cursor:"pointer"},on:{click:t._addBillItem}},[a("i",{staticClass:"el-icon-plus"}),t._v(" "),a("span",{attrs:{type:"primary"}},[t._v("新增")])]),t._v(" "),a("div",{staticStyle:{clear:"both"}}),t._v(" "),a("div",{staticClass:"scrollForm"},[a("el-scrollbar",t._l(t.formData,function(e,n){return a("div",{key:n},[a("div",{staticClass:"itemTitle"},[t._v("\n              调整单"+t._s(Number(n)+1)+"\n              "),0!==n?a("div",{staticStyle:{float:"right",color:"#006072"},on:{click:function(e){t.deleteItem(n)}}},[a("i",{staticClass:"el-icon-delete"}),t._v("删除\n              ")]):t._e()]),t._v(" "),a("div",{staticClass:"lineClass"}),t._v(" "),a("el-form-item",{staticClass:"settleFormItem",attrs:{label:"调整项",required:""}},[a("el-cascader",{staticStyle:{width:"250px"},attrs:{options:t.dataTypeList,clearable:""},on:{change:function(e){t.handleChange(n)}},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"item.value"}})],1),t._v(" "),a("el-form-item",{staticClass:"settleFormItem",attrs:{label:"调整后金额",required:""}},[a("el-input",{staticStyle:{width:"230px"},attrs:{type:"number"},model:{value:e.account,callback:function(a){t.$set(e,"account",a)},expression:"item.account"}}),t._v("  元\n            ")],1),t._v(" "),a("el-form-item",{staticStyle:{width:"780px"},attrs:{label:"说明",required:""}},[a("el-input",{staticStyle:{width:"650px"},attrs:{rows:3,type:"textarea",maxlength:"200",placeholder:"请输入"},model:{value:e.remark,callback:function(a){t.$set(e,"remark",a)},expression:"item.remark"}}),t._v(" "),t.errTips[n]?a("div",{staticClass:"errTips"},[a("i",{staticClass:"el-icon-warning"}),t._v("\n                "+t._s(t.errTips[n])+"\n              ")]):t._e()],1)],1)}))],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-dialog-sub",on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{staticClass:"btn-dialog-primary",attrs:{type:"primary"},on:{click:t.submitUpload}},[t._v("提 交")])],1)],1)],1)},[],!1,null,null,null);o.options.__file="settleAccountsCostDetail.vue";e.default=o.exports},PvAq:function(t,e,a){"use strict";var n=a("YNDa");a.n(n).a},YNDa:function(t,e,a){},t2Y8:function(t,e,a){"use strict";var n=a("QbLZ"),l=a.n(n),s=a("L2JU");function o(t,e){return e.includes(t)}e.a={computed:l()({},Object(s.b)(["name","btnPermissionRoles"])),created:function(){this._initBtnPermission()},methods:{_initBtnPermission:function(){var t=function(t,e){var a=[];if(t.length)return t.map(function(t){var n=t.split(":")[0],l=t.split(":")[1];n===e&&a.push(l)}),a}(this.btnPermissionRoles,this.PATH);this.btnArr=t,this.buttonFilter=o}}}}}]);